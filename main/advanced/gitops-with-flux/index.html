
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.3.2">
    
    
      
        <title>GitOps with Flux - Amazon EKS Blueprints for Terraform</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.5d38496d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#manage-your-clusters-configuration-with-flux" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Amazon EKS Blueprints for Terraform" class="md-header__button md-logo" aria-label="Amazon EKS Blueprints for Terraform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EKS Blueprints for Terraform
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GitOps with Flux
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-ia/terraform-aws-eks-blueprints
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Amazon EKS Blueprints for Terraform" class="md-nav__button md-logo" aria-label="Amazon EKS Blueprints for Terraform" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Amazon EKS Blueprints for Terraform
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-ia/terraform-aws-eks-blueprints
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../core-concepts/" class="md-nav__link">
        Core Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          IAM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IAM" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          IAM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../iam/minimum-iam-policy/" class="md-nav__link">
        Minimum IAM policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../teams/" class="md-nav__link">
        Teams
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/emr-on-eks/" class="md-nav__link">
        EMR on EKS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Add-ons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Add-ons" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Add-ons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/agones/" class="md-nav__link">
        Agones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/apache-airflow/" class="md-nav__link">
        Apache Airflow add-on
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/argo-workflows/" class="md-nav__link">
        Argo Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/argocd/" class="md-nav__link">
        ArgoCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-cloudwatch-metrics/" class="md-nav__link">
        AWS CloudWatch Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-efs-csi-driver/" class="md-nav__link">
        AWS EFS CSI Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-for-fluent-bit/" class="md-nav__link">
        AWS for Fluent Bit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-fsx-csi-driver/" class="md-nav__link">
        Amazon FSx for Lustre CSI Driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-load-balancer-controller/" class="md-nav__link">
        AWS Load Balancer Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-node-termination-handler/" class="md-nav__link">
        AWS Node Termination Handler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/aws-privateca-issuer/" class="md-nav__link">
        aws-privateca-issuer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/calico/" class="md-nav__link">
        Calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cert-manager-csi-driver/" class="md-nav__link">
        cert-manager-csi-driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cert-manager-istio-csr/" class="md-nav__link">
        cert-manager-istio-csr
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cert-manager/" class="md-nav__link">
        cert-manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/chaos-mesh/" class="md-nav__link">
        Chaos Mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cilium/" class="md-nav__link">
        Cilium
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cluster-autoscaler/" class="md-nav__link">
        Cluster Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/cluster-proportional-autoscaler/" class="md-nav__link">
        Horizontal cluster-proportional-autoscaler container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/consul/" class="md-nav__link">
        Consul
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/crossplane/" class="md-nav__link">
        Crossplane
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/csi-secrets-store-provider-aws/" class="md-nav__link">
        secrets-store-csi-driver-provider-aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/datadog-operator/" class="md-nav__link">
        Datadog Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/external-dns/" class="md-nav__link">
        ExternalDNS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/external-secrets/" class="md-nav__link">
        External Secrets Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/fargate-fluent-bit/" class="md-nav__link">
        Fargate fluent bit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/gatekeeper/" class="md-nav__link">
        Gatekeeper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kafka/" class="md-nav__link">
        Strimzi Operator for Apache Kafka
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/karpenter/" class="md-nav__link">
        Karpenter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/keda/" class="md-nav__link">
        KEDA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kube-prometheus-stack/" class="md-nav__link">
        kube-prometheus-stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kube-state-metrics/" class="md-nav__link">
        Kube-State-Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kubecost/" class="md-nav__link">
        Kubecost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kuberay-operator/" class="md-nav__link">
        KubeRay Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kubernetes-dashboard/" class="md-nav__link">
        Kubernetes Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/kyverno/" class="md-nav__link">
        Kyverno
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/local-volume-provisioner/" class="md-nav__link">
        Local volume provisioner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/managed-add-ons/" class="md-nav__link">
        Amazon EKS Add-ons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/metrics-server/" class="md-nav__link">
        Metrics Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/nvidia-device-plugin/" class="md-nav__link">
        NVIDIA Device Plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/portworx/" class="md-nav__link">
        Portworx add-on for EKS Blueprints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/promtail/" class="md-nav__link">
        Promtail
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/secrets-store-csi-driver/" class="md-nav__link">
        secrets-store-csi-driver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/smb-csi-driver/" class="md-nav__link">
        SMB CSI Driver Helm Chart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/spark-history-server/" class="md-nav__link">
        Spark History Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/spark-on-k8s-operator/" class="md-nav__link">
        Spark K8S Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/tetrate-istio/" class="md-nav__link">
        Tetrate Istio Distro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/thanos/" class="md-nav__link">
        Thanos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/traefik/" class="md-nav__link">
        Traefik
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/vault/" class="md-nav__link">
        HashiCorp Vault
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/velero/" class="md-nav__link">
        Velero
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/vpa/" class="md-nav__link">
        Vertical Pod Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../add-ons/yunikorn/" class="md-nav__link">
        Apache YuniKorn
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bottlerocket/" class="md-nav__link">
        Bottlerocket
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-upgrades/" class="md-nav__link">
        Cluster Upgrades
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ecr-instructions/" class="md-nav__link">
        ECR Instructions
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GitOps with Flux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GitOps with Flux
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bootstrap-your-cluster-with-flux" class="md-nav__link">
    Bootstrap your cluster with Flux
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap your cluster with Flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-your-cluster" class="md-nav__link">
    Bootstrap your cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi-cluster/" class="md-nav__link">
        Multi-cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../private-clusters/" class="md-nav__link">
        Private Clusters
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../extensibility/" class="md-nav__link">
        Extensibility
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bootstrap-your-cluster-with-flux" class="md-nav__link">
    Bootstrap your cluster with Flux
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap your cluster with Flux">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-your-cluster" class="md-nav__link">
    Bootstrap your cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/aws-ia/terraform-aws-eks-blueprints/edit/main/docs/advanced/gitops-with-flux.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="manage-your-clusters-configuration-with-flux">Manage your cluster(s) configuration with Flux<a class="headerlink" href="#manage-your-clusters-configuration-with-flux" title="Permanent link">&para;</a></h1>
<p>Once you have deployed your EKS cluster(s) with Terraform, you can leverage <a href="https://fluxcd.io">Flux</a> to manage your cluster's configuration with <a href="https://www.gitops.tech/">GitOps</a>, including the deployment of add-ons, cluster configuration (e.g. cluster policies) and applications. Using GitOps practices to manage your clusters configuration will simplify management, scaling the number of clusters you run and be able to easily recreate your clusters, treating them as ephemeral resources. Recreating your cluster is as simple as deploying a new cluster with Terraform and bootstrapping it with Flux pointing to the repository containing the configuration.</p>
<p>The <a href="https://github.com/aws-samples/flux-eks-gitops-config">aws-samples/flux-eks-gitops-config</a> repository provides a sample configuration blueprint for configuring multiple Amazon EKS clusters belonging to different stages (<code>test</code> and <code>production</code>) using <a href="https://www.gitops.tech/">GitOps</a> with <a href="https://fluxcd.io/docs/">Flux v2</a>. This repository installs a set of commonly used Kubernetes add-ons to perform policy enforcement, restrict network traffic with network policies, cluster monitoring, extend Kubernetes deployment capabilities enabling progressive Canary deployments for your applications...</p>
<p>You can use the above sample repository to experiment with the predefined cluster configurations and use it as a baseline to adjust it to your own needs.</p>
<p>This sample installs the following Kubernetes add-ons:</p>
<ul>
<li><strong><a href="https://github.com/kubernetes-sigs/metrics-server">metrics-server</a>:</strong> Aggregator of resource usage data in your cluster, commonly used by other Kubernetes add ons, such us <a href="https://docs.aws.amazon.com/eks/latest/userguide/horizontal-pod-autoscaler.html">Horizontal Pod Autoscaler</a> or <a href="https://docs.aws.amazon.com/eks/latest/userguide/dashboard-tutorial.html">Kubernetes Dashboard</a>.</li>
<li><strong><a href="https://docs.tigera.io/calico/next/about/">Calico</a>:</strong> Project Calico is a network policy engine for Kubernetes. Calico network policy enforcement allows you to implement network segmentation and tenant isolation. For more information check the <a href="https://docs.aws.amazon.com/eks/latest/userguide/calico.html">Amazon EKS documentation</a>.</li>
<li><strong><a href="https://kyverno.io/">Kyverno</a>:</strong> Kubernetes Policy Management Engine. Kyverno allows cluster administrators to manage environment specific configurations independently of workload configurations and enforce configuration best practices for their clusters. Kyverno can be used to scan existing workloads for best practices, or can be used to enforce best practices by blocking or mutating API requests.</li>
<li><strong><a href="https://prometheus.io/">Prometheus</a>:</strong> Defacto standard open-source systems monitoring and alerting toolkit for Kubernetes. This repository installs <a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack">kube-prometheus-stack</a>.</li>
<li><strong><a href="https://flagger.app/">Flagger</a>:</strong> Progressive delivery operator for Flux. Flagger can run automated application analysis, testing, promotion and rollback for the following deployment strategies: Canary, A/B Testing and Blue/Green. For more details, check the <a href="https://docs.flagger.app/">Flagger documentation</a>.</li>
<li><strong><a href="https://kubernetes.github.io/ingress-nginx/">nginx-ingress-controller</a>:</strong> Ingress controller to expose apps and enable <a href="https://docs.flagger.app/tutorials/nginx-progressive-delivery">canary deployments and A/B testing with Flagger</a>.</li>
</ul>
<p><strong>NOTE:</strong> The add-ons on the sample are not configured for a production-ready cluster (e.g. Prometheus would need to be configured for long term metric storage, nginx would need HPA and any custom settings you need...).</p>
<p>There're also a set of Kyverno cluster policies deployed to audit (test) or enforce (production) security settings on your workloads, as well as <a href="https://github.com/stefanprodan/podinfo">podinfo</a> as a sample application, configured with <a href="https://flagger.app/">Flagger</a> to perform progressive deployments. For further information, visit the <a href="https://github.com/aws-samples/flux-eks-gitops-config">aws-samples/flux-eks-gitops-config</a> repository documentation.</p>
<h2 id="bootstrap-your-cluster-with-flux">Bootstrap your cluster with Flux<a class="headerlink" href="#bootstrap-your-cluster-with-flux" title="Permanent link">&para;</a></h2>
<p>The below instructions assume you have created a cluster with <code>eks-blueprints</code> with no add-ons other than aws-load-balancer-controller. If you're installing additional add-ons via terraform, the configuration may clash with the one on the sample repository. If you plan to leverage Flux, we recommend that you use Terraform to install and manage only add-ons that require additional AWS resources to be created (like IAM roles for Service accounts), and then use Flux to manage the rest.</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>The add-ons and configurations of this repository require Kubernetes 1.21 or higher (this is required by the version of kube-prometheus-stack that is installed, you can use 1.19+ installing previous versions of kube-prometheus-stack).</p>
<p>You'll also need the following:</p>
<ul>
<li>Install flux CLI on your computer following the instructions <a href="https://fluxcd.io/docs/installation/">here</a>. This repository has been tested with flux 0.22.</li>
<li>A GitHub account and a <a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">personal access token</a> that can create repositories.</li>
</ul>
<h3 id="bootstrap-your-cluster">Bootstrap your cluster<a class="headerlink" href="#bootstrap-your-cluster" title="Permanent link">&para;</a></h3>
<p>Fork the <a href="https://github.com/aws-samples/flux-eks-gitops-config">aws-samples/flux-eks-gitops-config</a> repository on your personal GitHub account and export your GitHub access token, username and repo name:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;your-token&gt;
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_USER</span><span class="o">=</span>&lt;your-username&gt;
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">GITHUB_REPO</span><span class="o">=</span>&lt;repository-name&gt;
</code></pre></div>
<p>Define whether you want to bootstrap your cluster with the <code>TEST</code> or the <code>PRODUCTION</code> configuration:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># TEST configuration</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER_ENVIRONMENT</span><span class="o">=</span><span class="nb">test</span>

<span class="w">  </span><span class="c1"># PRODUCTION configuration</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER_ENVIRONMENT</span><span class="o">=</span>production
</code></pre></div>
<p>Verify that your staging cluster satisfies the prerequisites with:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>flux<span class="w"> </span>check<span class="w"> </span>--pre
</code></pre></div>
<p>You can now bootstrap your cluster with Flux CLI.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>flux<span class="w"> </span>bootstrap<span class="w"> </span>github<span class="w"> </span>--owner<span class="o">=</span><span class="si">${</span><span class="nv">GITHUB_USER</span><span class="si">}</span><span class="w"> </span>--repository<span class="o">=</span><span class="si">${</span><span class="nv">GITHUB_REPO</span><span class="si">}</span><span class="w"> </span>--branch<span class="o">=</span>main<span class="w"> </span>--path<span class="o">=</span>clusters/<span class="si">${</span><span class="nv">CLUSTER_ENVIRONMENT</span><span class="si">}</span><span class="w"> </span>--personal
</code></pre></div>
<p>The bootstrap command commits the manifests for the Flux components in <code>clusters/${CLUSTER_ENVIRONMENT}/flux-system</code> directory and creates a deploy key with read-only access on GitHub, so it can pull changes inside the cluster.</p>
<p>Confirm that Flux has finished applying the configuration to your cluster (it will take 3 or 4 minutes to sync everything):</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>$<span class="w"> </span>flux<span class="w"> </span>get<span class="w"> </span>kustomization
<span class="w">  </span>NAME<span class="w">                </span>READY<span class="w"> </span>MESSAGE<span class="w">                                                           </span>REVISION<span class="w">                                        </span>SUSPENDED
<span class="w">  </span>apps<span class="w">                </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>False
<span class="w">  </span>calico-installation<span class="w"> </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>master/00a2f33ea55f2018819434175c09c8bd8f20741a<span class="w"> </span>master/00a2f33ea55f2018819434175c09c8bd8f20741a<span class="w"> </span>False
<span class="w">  </span>calico-operator<span class="w">     </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>master/00a2f33ea55f2018819434175c09c8bd8f20741a<span class="w"> </span>master/00a2f33ea55f2018819434175c09c8bd8f20741a<span class="w"> </span>False
<span class="w">  </span>config<span class="w">              </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>main/8fd33f531df71002f2da7bc9619ee75281a9ead0<span class="w">   </span>main/8fd33f531df71002f2da7bc9619ee75281a9ead0<span class="w">   </span>False
<span class="w">  </span>flux-system<span class="w">         </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>False
<span class="w">  </span>infrastructure<span class="w">      </span>True<span class="w">  </span>Applied<span class="w"> </span>revision:<span class="w"> </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>main/b7d10ca21be7cac0dcdd14c80353012ccfedd4fe<span class="w">   </span>False
</code></pre></div>
<p>Get the URL for the nginx ingress controller that has been deployed in your cluster (you will see two ingresses, since Flagger will create a canary ingress):</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>podinfo
<span class="w">   </span>NAME<span class="w">             </span>CLASS<span class="w">   </span>HOSTS<span class="w">          </span>ADDRESS<span class="w">                               </span>PORTS<span class="w">   </span>AGE
<span class="w">   </span>podinfo<span class="w">          </span>nginx<span class="w">   </span>podinfo.test<span class="w">   </span>k8s-xxxxxx.elb.us-west-2.amazonaws.com<span class="w">   </span><span class="m">80</span><span class="w">      </span>23h
<span class="w">   </span>podinfo-canary<span class="w">   </span>nginx<span class="w">   </span>podinfo.test<span class="w">   </span>k8s-xxxxxx.elb.us-west-2.amazonaws.com<span class="w">   </span><span class="m">80</span><span class="w">      </span>23h
</code></pre></div>
<p>Confirm that podinfo can be correctly accessed via ingress:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Host: podinfo.test&quot;</span><span class="w"> </span>k8s-xxxxxx.elb.us-west-2.amazonaws.com
<span class="w">  </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;hostname&quot;</span>:<span class="w"> </span><span class="s2">&quot;podinfo-primary-65584c8f4f-d7v4t&quot;</span>,
<span class="w">  </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;6.0.0&quot;</span>,
<span class="w">  </span><span class="s2">&quot;revision&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,
<span class="w">  </span><span class="s2">&quot;color&quot;</span>:<span class="w"> </span><span class="s2">&quot;#34577c&quot;</span>,
<span class="w">  </span><span class="s2">&quot;logo&quot;</span>:<span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/stefanprodan/podinfo/gh-pages/cuddle_clap.gif&quot;</span>,
<span class="w">  </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;greetings from podinfo v6.0.0&quot;</span>,
<span class="w">  </span><span class="s2">&quot;goos&quot;</span>:<span class="w"> </span><span class="s2">&quot;linux&quot;</span>,
<span class="w">  </span><span class="s2">&quot;goarch&quot;</span>:<span class="w"> </span><span class="s2">&quot;amd64&quot;</span>,
<span class="w">  </span><span class="s2">&quot;runtime&quot;</span>:<span class="w"> </span><span class="s2">&quot;go1.16.5&quot;</span>,
<span class="w">  </span><span class="s2">&quot;num_goroutine&quot;</span>:<span class="w"> </span><span class="s2">&quot;10&quot;</span>,
<span class="w">  </span><span class="s2">&quot;num_cpu&quot;</span>:<span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="w">  </span><span class="o">}</span>
</code></pre></div>
<p>Congratulations! Your cluster has sync'ed all the configuration defined on the repository. Continue exploring the deployed configuration following these docs:</p>
<ul>
<li><a href="https://github.com/aws-samples/flux-eks-gitops-config/blob/main/docs/repository-structure.md">Review the repository structure to understand the applied configuration</a></li>
<li><a href="https://github.com/aws-samples/flux-eks-gitops-config/blob/main/docs/test-kyverno-policies.md">Test the cluster policies configured with Kyverno</a></li>
<li><a href="https://github.com/aws-samples/flux-eks-gitops-config/blob/main/docs/flagger-canary-deployments.md">Test progressive deployments with Flux, Flagger and nginx controller</a></li>
</ul>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../ecr-instructions/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ECR Instructions" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ECR Instructions
            </div>
          </div>
        </a>
      
      
        
        <a href="../multi-cluster/" class="md-footer__link md-footer__link--next" aria-label="Next: Multi-cluster" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Multi-cluster
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.7f366e99.min.js"></script>
      
    
  </body>
</html>